
<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>stv ⭐</title>
		<link rel="stylesheet" href="/assets/css/main.css" />
	</head>
	<body>
		<main>
			
<div class="header">
	<a href="/">← home</a></div>
<div class="blog-content">
	<article>
		<small class="date">10/30/2022</small>
		<h1>making maps with just ascii</h1>
		<h2>i thought too much about this</h2>
		<h3 id="what's-a-map%3F" tabindex="-1">what's a map?</h3>
<p>In creating the <a href="/blog/creating-twine-format">explorer format</a>, I wanted to have easy support for doing 2D, Super Metroid-style maps. In essence this is a grid, which each block on the grid showing a specific style of square or rectangle, correlating with the area the player is in.</p>
<p class="img"><img src="/blog/images/retropixel-net-brinstar.gif" alt="Super Metroid Map of Brinstar" /></p>
<p class="caption">Super Metroid Map of Brinstar</p>
<p>Ignoring the text labels (and elevator shafts), essentially this map shows two things:</p>
<ol>
<li>Whether a grid on the map is part of the map (pink) or not (black).</li>
<li>How each grid block connects (or doesn't connect) to adjacent blocks, visualized by &quot;walls.&quot;</li>
</ol>
<h3 id="use-in-twine" tabindex="-1">use in twine</h3>
<p>Twine (or Twee, in this case), is basically a fancy way of reading a text file (much like how this page is a fancy way of reading a <a href="https://github.com/washingtonsteven/the-website/blob/main/blog/making-ascii-maps.md">Markdown file</a>). It would be great to have the map data in that text file as well, and in a fairly easy to read and write format.</p>
<p>That last requirement basically rules out XML (cause it isn't 2009 anymore) and JSON (I love you JSON, but visualizing a map from JSON is a nightmare).</p>
<p>A simple map could be done using just ASCII characters, especially if you author it in a monospace font. Here's a simple 10x10 map:</p>
<pre><code>xxxxxxxxxx
xxxx00xxxx
xxxx00xxxx
xxx0000xxx
xxx000000x
xx00000xxx
xx00xxxxxx
xx000xxxxx
xx00000xxx
xxxxxxxxxx
</code></pre>
<p>Here <code>x</code> means &quot;The player can't go here&quot; and <code>0</code> means &quot;the player can be here&quot;</p>
<p>And here's how it would appear:</p>
<p class="img"><img src="/blog/images/map-screenshot.png" alt="Screenshot of the above map on a grid" /></p>
<p class="caption">Screenshot of the above map on a grid</p>
<p>Easy! Time to wipe our hands and call it a day, except...</p>
<h3 id="walls" tabindex="-1">walls</h3>
<p>So we've achieved goal #1, show where the player can be. But what about goal #2, show the connections between rooms?</p>
<p>Surely we'll need more than <code>x</code> and <code>0</code> to denote whether a block has walls. But how? We could use a separate piece of data to say something like &quot;coordinate (1,0) has walls on the top and right, but not bottom and left,&quot; but that starts getting real clunky again. Is there a way we can encode that information into a single character?</p>
<h3 id="wall-states" tabindex="-1">wall states</h3>
<p>So, if we look at a single block, we can have a wall on top, right, bottom, and left, and any combination of those, which is 16 combinations:</p>
<ol>
<li>no walls</li>
<li>top only</li>
<li>left only</li>
<li>bottom only</li>
<li>right only</li>
<li>top and left</li>
<li>top and bottom</li>
<li>top and right</li>
<li>left and bottom</li>
<li>left and right</li>
<li>bottom and right</li>
<li>top, left, and bottom</li>
<li>top, left, and right</li>
<li>left, bottom, and right</li>
<li>bottom, right, top</li>
<li>top, left, bottom, right (all of the walls!)</li>
</ol>
<p>Now, this would work with any system, but 16 is a number system we see a lot, especially in web development: hexadecimal! We can attribute a character 0-9 and a-f to represent each of the 16 states above</p>
<h3 id="sorta-random-choice" tabindex="-1">sorta random choice</h3>
<p>We can pick an arbitrary mapping of hex char to wall configuration, and that'll work fine as long as it's clear in our code (i.e. a <code>const</code> somewhere). But we can do one better (or worse, depending on how much you understand of binary).</p>
<p>Since we have 4 walls per block, and the max number of bits a hex char would need is 4, we can do a kinda sorta bitmask to map a hex character to a wall state.</p>
<p>First, we do have to (arbitrarily) assign a bit to a wall. I chose to go from most significant bit to least, following the same order that things like <code>margin</code> and <code>border</code> follow in CSS: top, right, bottom, left:</p>
<table>
<thead>
<tr>
<th></th>
<th>top</th>
<th>right</th>
<th>bottom</th>
<th>left</th>
<th>binary</th>
<th>decimal</th>
<th>hex</th>
</tr>
</thead>
<tbody>
<tr>
<td>no walls</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0000</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>top and bottom</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1010</td>
<td>10</td>
<td>a</td>
</tr>
<tr>
<td>all walls</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1111</td>
<td>15</td>
<td>f</td>
</tr>
<tr>
<td>etc...</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>So now we can use a single character to determine how many walls need to be on each part of the map. Using this we can create single rooms, hallways, and corners fairly easily!</p>
<h3 id="final-result" tabindex="-1">final result</h3>
<p>So now we can take our map from earlier, and turn each grid into a hex char that represents the walls around it:</p>
<pre><code>xxxxxxxxxx
xxxx9cxxxx
xxxx14xxxx
xxx922cxxx
xxx1882aex
xx9022exxx
xx34xxxxxx
xx92cxxxxx
xx3a2aexxx
xxxxxxxxxx
</code></pre>
<p>(note: I did set up some of the interior walls to &quot;double up&quot; and show on both adjacent blocks in order to be more prominent, but how that is displayed can be up to you!)</p>
<p>And that comes out looking something like this:</p>
<p class="img"><img src="/blog/images/mapwalls-screenshot.png" alt="The same Map screnshots from earlier, but with borders highlights in white"></p>
<p class="caption">The same Map screnshots from earlier, but with borders highlights in white</p>
<p>We now have our small use case fulfilling the above criteria:</p>
<ol>
<li>We know where the player can and can't be</li>
<li>We know how each block connects to the others (in this case, this is one large room with some walls the player has to go around)</li>
</ol>
<h3 id="conclusion" tabindex="-1">conclusion</h3>
<p>This was my first time working directly with bit maps and bit masking. You can see the code that taskes the ascii char and converts it to drawing a border in the <a href="https://github.com/washingtonsteven/explorer-format/blob/main/src/CanvasMap.ts#L334-L385">explorer format source</a>. Could I have made that code nicer? Probably. There's maybe some bitshifting that can happen to make this a bit smoother, but that's for another time, I guess!</p>

	</article>
	<aside>
	<nav class="toc" >
        <ol><li><a href="#what's-a-map%3F">what's a map?</a></li><li><a href="#use-in-twine">use in twine</a></li><li><a href="#walls">walls</a></li><li><a href="#wall-states">wall states</a></li><li><a href="#sorta-random-choice">sorta random choice</a></li><li><a href="#final-result">final result</a></li><li><a href="#conclusion">conclusion</a></li></ol>
      </nav>
	</aside>
</div>
<div class="footer">
	<a href="/">← home</a></div>
		</main>
		<footer>
			<small>made with <a href="https://www.11ty.dev/">11ty</a>. <a href="https://github.com/washingtonsteven/the-website">site source</a>. copyright? eh.</small>
		</footer>
	</body>
</html>